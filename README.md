# Gemini IDE Bridge

> 🚀 将 Google Gemini 网页进化成本地 IDE 的浏览器插件

## 项目概述

Gemini IDE Bridge 是一个 Chrome 扩展插件，将 Google Gemini 的 AI 对话能力与本地文件系统无缝连接，让你可以直接在 Gemini 网页上进行代码开发、文件管理和项目操作。

---

## 当前版本: V1.0.0

### 已实现功能

| 功能 | 状态 | 说明 |
|------|------|------|
| 本地文件夹连接 | ✅ | File System Access API |
| 文件树扫描 | ✅ | 自动忽略 node_modules/.git 等 |
| 侧边栏 UI | ✅ | 悬浮球触发，支持亮/暗主题自动切换 |
| 文件读取 | ✅ | 点击文件发送到 Gemini |
| 文件写入 | ✅ | AI 输出一键保存到本地 |
| 增量修改 | ✅ | SEARCH/REPLACE 格式 |
| 新建文件 | ✅ | 右键菜单 + AI 输出 |
| 删除文件 | ✅ | 右键菜单 + DELETE 指令 |
| 版本回退 | ✅ | IndexedDB 持久化，每文件保留 10 个版本 |
| 修改预览 | ✅ | 应用前显示新旧对比 |
| 撤销按钮 | ✅ | 应用后可一键撤销 |
| 提示词 | ✅ | 一键发送系统提示词 |
| 静默刷新 | ✅ | 文件操作后自动刷新文件树 |
| 智能匹配 | ✅ | 三层匹配：精确→模糊→相似度 |
| 状态持久化 | ✅ | 页面刷新后保留已应用状态 |
| 依赖分析 | ✅ | 自动解析 import/require，一键发送文件及依赖 |
| JS 语法检查 | ✅ | 应用补丁前检查语法，防止错误代码被应用 |

---

## 使用方法

### 安装

1. 打开 Chrome，访问 `chrome://extensions/`
2. 开启右上角「开发者模式」
3. 点击「加载已解压的扩展程序」
4. 选择本项目文件夹

### 基本操作

1. 访问 [gemini.google.com](https://gemini.google.com)
2. 点击左下角 `⚡️ IDE` 悬浮球
3. 点击「连接文件夹」选择本地项目
4. 点击「🤖 教导AI」让 Gemini 了解协作格式

### 文件操作

- **左键点击文件**: 发送文件内容到 Gemini
- **右键点击文件**: 历史版本、撤销、删除、发送文件+依赖
- **右键点击文件夹**: 发送目录、新建文件、删除

---

## AI 协作格式

### 1. 修改现有文件（增量修改）

```
<<<<<<< SEARCH [src/utils.js]
要被替换的原始代码
=======
替换后的新代码
>>>>>>> REPLACE
```

### 2. 删除代码段（REPLACE 留空）

```
<<<<<<< SEARCH [src/utils.js]
要删除的这段代码
=======
>>>>>>> REPLACE
```

### 3. 创建新文件

```javascript
// FILE: src/newFile.js
完整的文件内容...
```

### 4. 覆盖整个文件（大规模重构）

```javascript
// FILE: src/utils.js [OVERWRITE]
完整的新文件内容...
```

### 5. 删除文件

```
<<<<<<< DELETE [src/old.js]
>>>>>>> END
```

---

## 技术架构

```
┌─────────────────────────────────────────────────────────────┐
│                    Gemini 网页 (gemini.google.com)           │
├─────────────────────────────────────────────────────────────┤
│  ┌─────────────┐    注入     ┌─────────────────────────┐    │
│  │ content.js  │ ─────────▶ │     ide_core.js         │    │
│  │ (桥接脚本)   │            │  (核心逻辑,运行在页面)    │    │
│  └─────────────┘            └───────────┬─────────────┘    │
│                                         │                   │
│                              ┌──────────▼──────────┐        │
│                              │   侧边栏 UI 组件     │        │
│                              │  - 文件树           │        │
│                              │  - 操作按钮         │        │
│                              └──────────┬──────────┘        │
└─────────────────────────────────────────┼───────────────────┘
                                          │
                          File System Access API
                                          │
                              ┌───────────▼───────────┐
                              │     本地文件系统       │
                              │   (你的项目文件夹)     │
                              └───────────────────────┘
```

### 文件结构

```
gemini-ide-bridge/
├── manifest.json      # 插件配置 (MV3)
├── content.js         # 内容脚本
├── ide_core.js        # 构建产物（自动生成）
├── build.js           # 构建脚本
├── src/
│   ├── main.js        # 入口文件
│   ├── fs.js          # 文件系统模块
│   ├── ui.js          # UI 模块（侧边栏、文件树、菜单）
│   ├── gemini.js      # Gemini 交互模块（代码块监听、按钮注入）
│   ├── dialog.js      # 对话框模块（预览、历史对比）
│   ├── theme.js       # 主题模块（亮/暗主题检测与切换）
│   ├── history.js     # 版本历史模块
│   ├── parser.js      # 解析器模块（SEARCH/REPLACE/DELETE 指令解析）
│   ├── patcher.js     # 补丁模块（代码匹配算法：精确/模糊/智能）
│   ├── state.js       # 状态模块（已应用补丁的持久化）
│   ├── deps.js        # 依赖分析模块（JS/Python/C++ import 解析）
│   ├── prompt.js      # 提示词模块（系统提示词生成）
│   └── utils.js       # 工具函数
└── README.md
```

### V1.0.0 重构说明

为了提高代码可维护性，对大文件进行了模块化拆分：

| 模块 | 行数 | 职责 |
|------|------|------|
| ui.js | ~570 | 侧边栏、文件树、右键菜单 |
| gemini.js | ~400 | Gemini 交互、代码块监听、按钮注入 |
| dialog.js | ~235 | 预览对话框、历史版本对话框 |
| theme.js | ~115 | 主题检测、CSS 变量、亮暗切换 |
| parser.js | ~72 | 指令解析（SEARCH/REPLACE/DELETE/FILE） |
| patcher.js | ~126 | 代码匹配算法（精确→模糊→智能相似度）+ JS 语法检查 |
| state.js | ~77 | 补丁状态持久化（localStorage + 文件内容双重确认） |
| prompt.js | ~55 | 系统提示词生成 |
| deps.js | ~180 | 依赖分析（JS/TS/Python/C/C++ import 解析） |

原 gemini.js (685行) 拆分为 gemini.js + parser.js + patcher.js + state.js，职责更清晰。

---

## 开发

```bash
# 修改 src/ 下的源码后，运行构建
node build.js
```

然后在 Chrome 扩展页面点击刷新按钮。

---

## License

MIT
